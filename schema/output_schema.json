{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "API Spec Generator Output",
    "description": "Structured output for the API Copilot spec generator",
    "type": "object",
    "properties": {
        "modules": {
            "description": "List of identified modules in the product",
            "type": "array",
            "items": { "type": "string" }
        },
        "features_by_module": {
            "description": "Features grouped by module",
            "type": "object",
            "patternProperties": {
                ".*": {
                    "type": "array",
                    "items": { "type": "string" }
                }
            },
            "additionalProperties": false
        },
        "user_stories": {
            "description": "List of user stories in standard format",
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "id": { "type": "string" },
                    "as_a": { "type": "string" },
                    "i_want": { "type": "string" },
                    "so_that": { "type": "string" },
                    "module": { "type": "string" }
                },
                "required": ["as_a", "i_want", "so_that"],
                "additionalProperties": false
            }
        },
        "api_endpoints": {
            "description": "Suggested API endpoints",
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "method": { "type": "string", "enum": ["GET", "POST", "PUT", "PATCH", "DELETE"] },
                    "path": { "type": "string" },
                    "description": { "type": "string" },
                    "auth_required": { "type": "boolean" },
                    "request_body": { "type": ["object", "null"] },
                    "response": { "type": "object" },
                    "errors": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "properties": {
                                "code": { "type": "integer" },
                                "message": { "type": "string" }
                            },
                            "required": ["code", "message"]
                        }
                    }
                },
                "required": ["method", "path", "description"],
                "additionalProperties": false
            }
        },
        "db_schema": {
            "description": "Suggested database schema",
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "table_name": { "type": "string" },
                    "columns": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "properties": {
                                "name": { "type": "string" },
                                "type": { "type": "string" },
                                "constraints": {
                                    "type": "array",
                                    "items": { "type": "string" }
                                },
                                "nullable": { "type": "boolean" }
                            },
                            "required": ["name", "type"]
                        }
                    },
                    "relationships": {
                        "type": "array",
                        "items": { "type": "string" }
                    }
                },
                "required": ["table_name", "columns"],
                "additionalProperties": false
            }
        },
        "open_questions": {
            "description": "List of open questions or unclear parts from the requirements",
            "type": "array",
            "items": { "type": "string" }
        }
    },
    "required": ["modules", "features_by_module", "user_stories", "api_endpoints", "db_schema", "open_questions"],
    "additionalProperties": false
}